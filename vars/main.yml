---
# Hosts
system_hosts_localhosts: |
  {{
    ( [system_hosts_localhost] + system_hosts_localhost_aliases ) |
    product(['', '.' + system_hosts_domain]) |
    map('join')
  }}

system_hosts_loopback:
  - ip: "127.0.0.1"
    names: ['localhost']
  - ip: "127.0.1.1"
    names: "{{ system_hosts_localhosts }}"
  - ip: "::1"
    names: "{{ ['localhost', 'ip6-localhost', 'ip6-loopback'] + system_hosts_localhosts }}"

system_hosts: "{{ system_hosts_loopback + system_hosts_custom }}"

# Users
system_users_shells: |
  {{
    system_users |
    rejectattr('system', 'defined') |
    selectattr('shell', 'defined') |
    map(attribute='shell') |
    map('basename') |
    sort |
    unique
  }}

# Networks
system_networks_types: |
  {{
    system_networks_interfaces |
    selectattr('type', 'defined') |
    map(attribute='type') |
    map('lower') |
    sort |
    unique
  }}

# Packages
system_packages:
  bridge: bridge-utils
  ca_certificates: ca-certificates
  chrony: chrony
  common:
    - rsync
  desktop:
    - usbutils
  ntp: ntp

system_packages_computed: |
  {{
    ( system_packages_custom
    + system_packages.common
    + system_users_shells
    + (system_packages[system_profile] | default([]))
    + (system_packages_upgrade_unattended | ternary(system_packages_unattended_upgrades | default([]), []))
    + (system_ca_certificates | length > 0) | ternary([system_packages.ca_certificates], [])
    + (system_networks_types | intersect(system_packages.keys() | list) | map('extract', system_packages))
    + (system_manage_timesync and time_backend_name in system_packages) | ternary([system_packages[time_backend_name]], [])
    ) | sort | unique
  }}

# Time
time_backend_name: "{{ system_time_backend | default(default_time_backend | default('chrony')) }}"
time_backends:
  chrony:
    config: chrony.conf
    service: chronyd.service
  ntp:
    config: ntp.conf
    service: ntpd.service
  timesync:
    config: systemd/timesyncd.conf
    service: systemd-timesyncd.service
