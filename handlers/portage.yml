---
- name: Portage - Rebuild packages that need to be rebuilt
  listen: emerge --newuse
  become: true
  community.general.portage:
    deep: true
    newuse: true
    update: "{{ system_packages_update }}"
    package: '@world'

- name: Portage - Clean dependencies
  listen: emerge --newuse
  become: true
  community.general.portage:
    depclean: true

- name: Portage - Kernel modules rebuild
  listen: emerge @module-rebuild
  become: true
  community.general.portage:
    package: '@module-rebuild'
